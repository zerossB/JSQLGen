package gen.gui;

/**
 *
 * @author marcos
 */
public class ClassFormGen {

    private project.Project proj;
    private project.ClassBean classBean;

    /**
     * Construtor
     * @param proj
     * @param classBean 
     */
    public ClassFormGen(project.Project proj, project.ClassBean classBean){
        this.proj = proj;
        this.classBean = classBean;
    }
    
    /**
     * 
     * @param att
     * @return 
     */
    private AttributeGen getAttributeGen(project.Attribute att){
        switch(att.getType()){
            case IDENTITY    : return new AttributeIdentityGen(classBean, att);
            case INTEGER     : return new AttributeIntegerGen(classBean, att);
            case FLOAT       : return new AttributeFloatGen(classBean, att);
            case BOOLEAN     : return new AttributeBooleanGen(classBean, att);
            case STRING      : return new AttributeStringGen(classBean, att);
            case DATE        : return new AttributeDateGen(classBean, att);
            case TIME        : return new AttributeTimeGen(classBean, att);
            case IMAGE       : return new AttributeImageGen(classBean, att);
            case FIXED_LIST  : return new AttributeFixedListGen(classBean, att);
            case OBJECT      : return new AttributeObjectGen(proj, classBean, att);
            case OBJECT_LIST : return new AttributeObjectListGen(proj, classBean, att);
            default: return null;
        }
    }
    
    public String getJavaCode(){
        String code = "";
        code += "package "+classBean.getPackage(proj)+";\n";
        code += "/**\n";
        code += " *\n";
        code += " * @author jsqlgen\n";
        code += " */\n";
        code += "public class "+classBean.getName()+"Form extends javax.swing.JDialog {\n";
        code += "    private java.sql.Connection connection;\n";
        code += "    private "+classBean.getName()+" "+classBean.getNameL()+";\n";

        code += "\n";
        code += "    /** Creates new form "+classBean.getName()+"Form\n";
        code += "     * @param parent Janela mãe\n";
        code += "     * @param connection Conexão com o BD\n";
        code += "     * @param "+classBean.getNameL()+" Objeto a ser editado\n";
        code += "     */\n";
        code += "    public "+classBean.getName()+"Form(java.awt.Window parent, java.sql.Connection connection, "+classBean.getName()+" "+classBean.getNameL()+") {\n";
        code += "        super(parent);\n";
        code += "        this.connection = connection;\n";
        code += "        this."+classBean.getNameL()+" = "+classBean.getNameL()+";\n";
        code += "        initComponents();\n";
        code += "    }\n";

        code += "\n";
        code += "    /** Exibe caixa de diálogo para preenchimento dos campos\n";
        code += "     * @return the "+classBean.getNameL()+"\n";
        code += "     */\n";
        code += "    public "+classBean.getName()+" showInputDialog() {\n";
        code += "        obj2form();\n";
        code += "        this.setVisible(true);\n";
        code += "        return "+classBean.getNameL()+";\n";
        code += "    }\n";

        code += "\n";
        code += "    /** Transfere os dados do objeto para o formulário */\n";
        code += "    private void obj2form() {\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genObj2Form();
        }
        code += "    }\n";

        code += "\n";
        code += "    /** Transfere os dados do formulário para o objeto */\n";
        code += "    private void form2obj() {\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genForm2Obj();
        }
        code += "    }\n";

        code += "\n";
        code += "    /** valida os dados do formulário */\n";
        code += "    private String validateForm() {\n";
        code += "        String fieldError =\"\";\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genValidate();
        }
        code += "        return fieldError;\n";
        code += "    }\n";

        code += "\n";
        code += "    /** This method is called from within the constructor to\n";
        code += "     * initialize the form.\n";
        code += "     * WARNING: Do NOT modify this code. The content of this method is\n";
        code += "     * always regenerated by the Form Editor.\n";
        code += "     */\n";
        code += "    @SuppressWarnings(\"unchecked\")\n";
        code += "    // <editor-fold defaultstate=\"collapsed\" desc=\"Generated Code\">//GEN-BEGIN:initComponents\n";
        code += "    private void initComponents() {\n";
        code += "        pData = new javax.swing.JPanel();\n";
        code += "        tbData = new javax.swing.JTabbedPane();\n";
        code += "        pButtons = new javax.swing.JPanel();\n";
        code += "        bOk = new javax.swing.JButton();\n";
        code += "        bCancel = new javax.swing.JButton();\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genInstance();
        }
        code += "\n";
        code += "        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);\n";
        code += "        setTitle(\"Formulário de "+classBean.getName()+"\");\n";
        code += "        setModal(true);\n";
        code += "        addWindowListener(new java.awt.event.WindowAdapter() {\n";
        code += "            public void windowClosing(java.awt.event.WindowEvent evt) {\n";
        code += "                formWindowClosing(evt);\n";
        code += "            }\n";
        code += "        });\n\n";
        code += "        pData.setLayout(new java.awt.GridLayout(5, 0));\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genInitComponentPData();
        }
        code += "        getContentPane().add(pData, java.awt.BorderLayout.NORTH);\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genInitComponentTBData();
        }
        code += "        getContentPane().add(tbData, java.awt.BorderLayout.CENTER);\n";
        code += "        pButtons.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT));\n";
        code += "        bOk.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/toolbox/images/stock_calc-accept-16.png\"))); // NOI18N\n";
        code += "        bOk.setMnemonic('O');\n";
        code += "        bOk.setText(\"Ok\");\n";
        code += "        bOk.addActionListener(new java.awt.event.ActionListener() {\n";
        code += "            public void actionPerformed(java.awt.event.ActionEvent evt) {\n";
        code += "                bOkActionPerformed(evt);\n";
        code += "            }\n";
        code += "        });\n";
        code += "        pButtons.add(bOk);\n";
        code += "        bCancel.setIcon(new javax.swing.ImageIcon(getClass().getResource(\"/toolbox/images/stock_calc-cancel-16.png\"))); // NOI18N\n";
        code += "        bCancel.setMnemonic('C');\n";
        code += "        bCancel.setText(\"Cancelar\");\n";
        code += "        bCancel.addActionListener(new java.awt.event.ActionListener() {\n";
        code += "            public void actionPerformed(java.awt.event.ActionEvent evt) {\n";
        code += "                bCancelActionPerformed(evt);\n";
        code += "            }\n";
        code += "        });\n";
        code += "        pButtons.add(bCancel);\n";
        code += "        getContentPane().add(pButtons, java.awt.BorderLayout.SOUTH);\n";
        code += "        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();\n";
        code += "        setBounds((screenSize.width-800)/2, (screenSize.height-600)/2, 800, 600);\n";
        code += "    }// </editor-fold>//GEN-END:initComponents\n";

        code += "\n";
        code += "    private void bOkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bOkActionPerformed\n";
        code += "        String fieldError =validateForm();\n";
        code += "        if(fieldError.length()==0) {\n";
        code += "            form2obj();\n";
        code += "            this.setVisible(false);\n";
        code += "            this.dispose();\n";
        code += "        } else {\n";
        code += "            javax.swing.JOptionPane.showMessageDialog(this, \"Verifique os campos seguintes e tente novamente!\\n\"+fieldError,\"Aviso\",javax.swing.JOptionPane.ERROR_MESSAGE);\n";
        code += "        }\n";
        code += "    }//GEN-LAST:event_bOkActionPerformed\n";

        code += "\n";
        code += "    private void bCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bCancelActionPerformed\n";
        code += "        "+classBean.getNameL()+" = null;\n";
        code += "        this.setVisible(false);\n";
        code += "        this.dispose();\n";
        code += "    }//GEN-LAST:event_bCancelActionPerformed\n";

        code += "\n";
        java.util.List<project.Attribute> listImageAtt = classBean.getAttributesOfType(project.Attribute.Type.IMAGE);
        for(project.Attribute att : listImageAtt){
            code += new AttributeImageGen(classBean,att).genMethods();
        }
        
        code += "\n";
        code += "    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing\n";
        code += "        bCancelActionPerformed(null);\n";
        code += "    }//GEN-LAST:event_formWindowClosing\n\n";

        code += "\n";
        code += "    // Variables declaration - do not modify//GEN-BEGIN:variables\n";
        code += "    private javax.swing.JButton bCancel;\n";
        code += "    private javax.swing.JButton bOk;\n";
        code += "    private javax.swing.JPanel pButtons;\n";
        code += "    private javax.swing.JPanel pData;\n";
        code += "    private javax.swing.JTabbedPane tbData;\n";
        for(project.Attribute att : classBean.getAttributes()){
            code += getAttributeGen(att).genDeclaration();
        }
        code += "    // End of variables declaration//GEN-END:variables\n";
        code += "}\n";
        return code;
    }
}
